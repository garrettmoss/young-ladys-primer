(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[549],{65068:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dev/flow",function(){return n(6333)}])},6333:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return k}});var t=n(85893),i=n(67294),l=n(36851),c=n(59819),a=n(24885),r=n(70866),o=n(70681),d=n.n(o);n(47555);let x=["welcome","story_princess"],h=["change-name","settings"],m=["debug"];function u(e){return e.choices?e.choices.map(e=>e.action):[]}function p(e){return({entry:"#FFD700",convergence:"#4ECDC4",lesson:"#95E1D3",puzzle:"#F38181",ending:"#AA96DA",default:"#E0E0E0"})[e]}var g=n(66838);let f=e=>{let{nodeType:s}=e;return(0,t.jsx)("span",{className:"text-sm",role:"img","aria-label":s,children:{entry:"⭐",convergence:"◈",lesson:"\uD83D\uDCD6",puzzle:"\uD83D\uDD12",ending:"✦",default:"○"}[s]})},b=(0,i.memo)(e=>{let{data:s,selected:n}=e,{label:i,nodeType:c,choiceCount:a,incomingEdges:r}=s,o=p(c);return(0,t.jsxs)("div",{className:"relative",style:{width:250,minHeight:100},children:[(0,t.jsx)(l.HH,{type:"target",position:l.Ly.Top,className:"w-3 h-3",style:{background:o}}),(0,t.jsxs)("div",{className:"\n          bg-parchment rounded-lg shadow-md\n          border-2 transition-all duration-200\n          ".concat(n?"ring-2 ring-amber-500 ring-offset-2":"","\n        "),style:{borderColor:n?"#f59e0b":o,boxShadow:n?"0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.1)":"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},children:[r>=3&&(0,t.jsx)("div",{className:"absolute -top-2 -right-2 bg-flow-convergence text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold shadow-md z-10",title:"Convergence point: ".concat(r," paths merge here"),children:r}),(0,t.jsxs)("div",{className:"px-3 py-2 rounded-t-lg border-b border-ink/10 flex items-center gap-2",style:{backgroundColor:"".concat(o,"15")},children:[(0,t.jsx)(f,{nodeType:c}),(0,t.jsx)("span",{className:"text-xs font-medium uppercase tracking-wide text-ink/60",children:c})]}),(0,t.jsx)("div",{className:"px-3 py-3",children:(0,t.jsx)("h3",{className:"font-serif text-sm font-semibold text-ink leading-tight line-clamp-2",children:i})}),a>0&&(0,t.jsxs)("div",{className:"px-3 pb-2 text-xs text-ink/50",children:[a," ",1===a?"choice":"choices"]}),0===a&&(0,t.jsx)("div",{className:"px-3 pb-2 text-xs italic text-ink/50",children:"The End"})]}),a>0&&(0,t.jsx)(l.HH,{type:"source",position:l.Ly.Bottom,className:"w-3 h-3",style:{background:o}})]})});function j(e){let{isOpen:s,onClose:n,node:i,content:l,incomingConnections:c}=e;if(!s||!i||!l)return null;let{label:a,nodeType:r,choiceCount:o,incomingEdges:d}=i.data,x=l?"string"==typeof l.content?l.content:"[Dynamic content - varies based on context]":"",h=Math.ceil(x.split(/\s+/).length/200),m=p(r);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:n,"aria-hidden":"true"}),(0,t.jsxs)("aside",{className:"fixed right-0 top-0 h-screen w-96 bg-parchment border-l-2 border-ink/20 shadow-2xl z-50 overflow-y-auto",style:{borderLeftColor:m},children:[(0,t.jsx)("div",{className:"sticky top-0 bg-parchment border-b-2 border-ink/10 z-10 p-4",style:{backgroundColor:"".concat(m,"10")},children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h2",{className:"font-serif text-lg font-bold text-ink leading-tight",children:a}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium text-white",style:{backgroundColor:m},children:r}),d>=3&&(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-flow-convergence text-white",title:"Convergence point",children:"◈ Convergence"})]})]}),(0,t.jsx)("button",{onClick:n,className:"flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-full hover:bg-ink/10 transition-colors","aria-label":"Close sidebar",children:(0,t.jsx)("span",{className:"text-xl text-ink/60",children:"\xd7"})})]})}),(0,t.jsxs)("div",{className:"p-4 space-y-6",children:[(0,t.jsxs)("section",{children:[(0,t.jsx)("h3",{className:"font-serif text-sm font-semibold text-ink/80 mb-2 uppercase tracking-wide",children:"Metadata"}),(0,t.jsxs)("dl",{className:"space-y-1 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("dt",{className:"text-ink/60",children:"Node ID:"}),(0,t.jsx)("dd",{className:"font-mono text-xs text-ink",children:i.id})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("dt",{className:"text-ink/60",children:"Reading time:"}),(0,t.jsxs)("dd",{className:"text-ink",children:[h," min"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("dt",{className:"text-ink/60",children:"Choices:"}),(0,t.jsx)("dd",{className:"text-ink",children:o})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("dt",{className:"text-ink/60",children:"Incoming paths:"}),(0,t.jsx)("dd",{className:"text-ink",children:d})]})]})]}),(0,t.jsxs)("section",{children:[(0,t.jsx)("h3",{className:"font-serif text-sm font-semibold text-ink/80 mb-2 uppercase tracking-wide",children:"Content"}),(0,t.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,t.jsx)("p",{className:"text-ink/80 leading-relaxed whitespace-pre-wrap",children:x})})]}),l.choices&&l.choices.length>0&&(0,t.jsxs)("section",{children:[(0,t.jsxs)("h3",{className:"font-serif text-sm font-semibold text-ink/80 mb-2 uppercase tracking-wide",children:["Choices (",l.choices.length,")"]}),(0,t.jsx)("ul",{className:"space-y-2",children:l.choices.map((e,s)=>(0,t.jsx)("li",{className:"p-2 bg-parchment-light rounded border border-ink/10",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsxs)("span",{className:"flex-shrink-0 text-ink/40 font-mono text-xs mt-0.5",children:[s+1,"."]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm text-ink font-medium leading-snug",children:e.text}),(0,t.jsxs)("p",{className:"text-xs text-ink/50 font-mono mt-1",children:["→ ",e.action]})]})]})},s))})]}),c.length>0&&(0,t.jsxs)("section",{children:[(0,t.jsxs)("h3",{className:"font-serif text-sm font-semibold text-ink/80 mb-2 uppercase tracking-wide",children:["Incoming Connections (",c.length,")"]}),(0,t.jsx)("ul",{className:"space-y-1",children:c.map((e,s)=>(0,t.jsxs)("li",{className:"p-2 bg-parchment-light rounded border border-ink/10 text-xs",children:[(0,t.jsxs)("div",{className:"font-mono text-ink/60 mb-1",children:["← ",e.sourceId]}),(0,t.jsxs)("div",{className:"text-ink/80 italic",children:['"',e.label,'"']})]},s))})]}),0===o&&(0,t.jsx)("section",{className:"bg-flow-ending/10 border border-flow-ending/30 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("span",{className:"text-2xl",children:"✦"}),(0,t.jsx)("p",{className:"text-ink/80 italic",children:"This is an ending node. The story concludes here."})]})})]})]})]})}function N(e){let{contentFilter:s,entryPoint:n,showProgress:o=!1}=e,[p,f]=(0,i.useState)(null),[N,k]=(0,i.useState)(!1),{nodes:y,edges:w}=(0,i.useMemo)(()=>(function(e){let s=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=[],t=[],i=s?Object.fromEntries(Object.entries(e).filter(e=>{let[s]=e;return!m.includes(s)})):e,l={};return Object.entries(i).forEach(e=>{let[s,n]=e;u(n).forEach(e=>{h.includes(e)||(l[e]=(l[e]||0)+1)})}),Object.entries(i).forEach(e=>{var s,t,c,a;let r;let[o,d]=e,h=(t=o,c=d,a=i,x.includes(t)?"entry":c.choices&&0!==c.choices.length?t.includes("lesson")||t.includes("nano_")||t.includes("molecular")?"lesson":t.includes("puzzle")||t.includes("lock")||t.includes("chamber")?"puzzle":(r=0,Object.entries(a).forEach(e=>{let[s,n]=e;u(n).includes(t)&&r++}),r>=3)?"convergence":"default":"ending"),m=l[o]||0;n.push({id:o,data:{label:d.title,contentPreview:function(e){let s=("string"==typeof e.content?e.content:"[Dynamic content]").replace(/\*\*/g,"").replace(/\*/g,"").replace(/\n/g," ").trim();return s.length>100?s.substring(0,100)+"...":s}(d),nodeType:h,choiceCount:(null===(s=d.choices)||void 0===s?void 0:s.length)||0,incomingEdges:m},position:{x:0,y:0},type:"default"})}),Object.entries(i).forEach(e=>{let[s,n]=e;(n.choices||[]).forEach((e,n)=>{let l=e.action;!h.includes(l)&&i[l]&&t.push({id:"".concat(s,"-").concat(l,"-").concat(n),source:s,target:l,label:e.text.length>30?e.text.substring(0,30)+"...":e.text,animated:!1})})}),{nodes:n,edges:t}})(g.gq),[]),v=(0,i.useMemo)(()=>(function(e,s){let n=new(d()).graphlib.Graph;return n.setDefaultEdgeLabel(()=>({})),n.setGraph({rankdir:"TB",nodesep:80,ranksep:120,marginx:50,marginy:50}),e.forEach(e=>{n.setNode(e.id,{width:250,height:100})}),s.forEach(e=>{n.setEdge(e.source,e.target)}),d().layout(n),e.map(e=>{let s=n.node(e.id);return{...e,position:{x:s.x-125,y:s.y-50}}})})(y,w),[y,w]),[C,E,D]=(0,l.Rr)(v),[z,_,T]=(0,l.ll)(w),O=(0,i.useMemo)(()=>({default:b}),[]),M=(0,i.useCallback)((e,s)=>{f(s.id),k(!0)},[]),A=(0,i.useCallback)(()=>{k(!1),f(null)},[]),F=(0,i.useMemo)(()=>p&&C.find(e=>e.id===p)||null,[p,C]),I=(0,i.useMemo)(()=>p?g.gq[p]:null,[p]),H=(0,i.useMemo)(()=>p?z.filter(e=>e.target===p).map(e=>({sourceId:e.source,label:e.label||"Unlabeled"})):[],[p,z]);return(0,t.jsxs)("div",{className:"w-full h-screen bg-parchment-light",children:[(0,t.jsxs)(l.x$,{nodes:C,edges:z,onNodesChange:D,onEdgesChange:T,onNodeClick:M,nodeTypes:O,fitView:!0,minZoom:.1,maxZoom:2,defaultEdgeOptions:{type:"smoothstep",animated:!1,style:{stroke:"#64402e",strokeWidth:2}},children:[(0,t.jsx)(c.A,{variant:c.T.Dots,gap:20,size:1,color:"#d4c5b0"}),(0,t.jsx)(a.Z,{className:"bg-parchment border border-ink/20 rounded-lg shadow-lg",showInteractive:!1}),(0,t.jsx)(r.a,{nodeColor:e=>{let s=e.data,n={entry:"#FFD700",convergence:"#4ECDC4",lesson:"#95E1D3",puzzle:"#F38181",ending:"#AA96DA",default:"#E0E0E0"};return n[s.nodeType]||n.default},className:"bg-parchment border border-ink/20 rounded-lg shadow-lg",maskColor:"rgba(249, 246, 240, 0.6)"})]}),(0,t.jsx)(j,{isOpen:N,onClose:A,node:F,content:I,incomingConnections:H})]})}function k(){return(0,t.jsx)("div",{className:"w-full h-screen",children:(0,t.jsx)(N,{})})}b.displayName="StoryNode"}},function(e){e.O(0,[241,259,838,888,774,179],function(){return e(e.s=65068)}),_N_E=e.O()}]);